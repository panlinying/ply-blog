"use strict";function checkSingle(evt){evt.attr("class")==cb_check?evt.attr("class",cb_checked):evt.attr("class",cb_check)}function checkAll(evt,tar){evt.attr("class")==cb_check?(evt.attr("class",cb_checked),tar.attr("class",cb_checked)):(evt.attr("class",cb_check),tar.attr("class",cb_check))}var app=angular.module("jeanineApp",["ngRoute","ngCookies","ngSanitize","ngCsv","naif.base64","ngCropper"]);app.factory("myHttpInterceptor",function($q,$location,$cookieStore){return{request:function(request){request.headers=request.headers||{};var token=$cookieStore.get("brand"),bpk=$cookieStore.get("bpk");return token&&(request.headers.Authorization=token),bpk&&(request.headers.bpk=bpk),request},responseError:function(rejection){var msg=rejection.statusText;return rejection.data&&rejection.data.detail&&(msg=rejection.data.detail),"Authentication credentials were not provided."!==msg&&"You do not have permission to perform this action."!==msg?""===msg||void 0===msg?$q.reject(rejection):($.msg_bre({content:msg}),$q.reject(rejection)):($.msg_bre({content:"权限不足"}),$cookieStore.remove("brand"),$cookieStore.remove("bpk"),$location.path("/login"),void 0)}}}),app.config(["$routeProvider","$httpProvider",function($routeProvider,$httpProvider){$httpProvider.interceptors.push("myHttpInterceptor"),$httpProvider.defaults.xsrfCookieName="csrftoken",$httpProvider.defaults.xsrfHeaderName="X-CSRFToken",$routeProvider.when("/",{templateUrl:"templates/home.html",controller:"HomeCtrl"}).when("/collection",{templateUrl:"templates/collection.html",controller:"CollectionCtrl"}).when("/code",{templateUrl:"templates/code.html",controller:"CodeCtrl"}).when("/coupon",{templateUrl:"templates/coupon.html",controller:"CouponCtrl"}).when("/output",{templateUrl:"templates/output.html",controller:"OutputCtrl"}).when("/buyer_list",{templateUrl:"templates/buyer_list.html",controller:"BuyerListCtrl"}).when("/buyer_detail/:buyer_id",{templateUrl:"templates/buyer_detail.html",controller:"BuyerDetailCtrl"}).when("/brand/:brand_id",{templateUrl:"templates/brand.html",controller:"BrandCtrl"}).when("/stylist/:brand_id",{templateUrl:"templates/stylist.html",controller:"StylistCtrl"}).when("/statistic",{templateUrl:"templates/statistic.html",controller:"StatisticCtrl"}).when("/product_manage",{templateUrl:"templates/product_manage.html",controller:"ProductManageCtrl"}).when("/product_new",{templateUrl:"templates/product_new.html",controller:"NewProductCtrl"}).when("/products/:product_id",{templateUrl:"templates/product.html",controller:"ProductCtrl"}).when("/products/:product_id/edit",{templateUrl:"templates/product_edit.html",controller:"ProductEditCtrl"}).when("/orders_new",{templateUrl:"templates/orders_new.html",controller:"ordersNewCtrl"}).when("/orders_unconfirm",{templateUrl:"templates/orders_unconfirm.html",controller:"OrdersUnconfirmCtrl"}).when("/orders_underway",{templateUrl:"templates/orders_underway.html",controller:"OrdersUnderwayCtrl"}).when("/orders_finish",{templateUrl:"templates/orders_finish.html",controller:"OrdersFinishCtrl"}).when("/orders_cancel",{templateUrl:"templates/orders_cancel.html",controller:"OrdersCancelCtrl"}).when("/orders_all",{templateUrl:"templates/orders_all.html",controller:"OrdersAllCtrl"}).when("/orders/:order_id",{templateUrl:"templates/order_detail.html",controller:"OrderDetailCtrl"}).when("/orders_statistics/:checked_id",{templateUrl:"templates/orders_statistics.html",controller:"OrderStatCtrl"}).when("/studio/studio_basic",{templateUrl:"templates/studio_edit.html",controller:"StudioEditCtrl"}).when("/studio/:studio_pwd",{templateUrl:"templates/studio_pwd.html",controller:"StudioPwdCtrl"}).when("/messages",{templateUrl:"templates/messages.html",controller:"MessagesCtrl"}).when("/register",{templateUrl:"templates/register.html",controller:"RegisterCtrl"}).when("/register_success",{templateUrl:"templates/register_success.html",controller:"RegisterSuccessCtrl"}).when("/login",{templateUrl:"templates/login.html",controller:"LoginCtrl"}).when("/forget_pwd",{templateUrl:"templates/forget_pwd.html",controller:"ForgetPwdCtrl"}).when("/activate/:code",{templateUrl:"templates/activate.html",controller:"ActivateCtrl"}).when("/reset_pwd/:code",{templateUrl:"templates/reset_pwd.html",controller:"ResetPwdCtrl"}).when("/preview_linesheet",{templateUrl:"templates/preview_linesheet.html",controller:"PreViewProductListCtrl"}).when("/preview_product/:id",{templateUrl:"templates/preview_product.html",controller:"PreViewProductCtrl"}).when("/preview_brand",{templateUrl:"templates/preview_brand.html",controller:"PreViewBrandCtrl"}).when("/404",{templateUrl:"templates/404.html"}).otherwise({redirectTo:"/404"})}]);var host="http://120.26.201.59";0===location.host.indexOf("127.0.0.1")&&(host="http://127.0.0.1:8000"),0===location.host.indexOf("192.168.0.162")&&(host="http://192.168.0.162:9000"),app.run(function($rootScope,$cookieStore,$location){$rootScope.host=host,$rootScope.$on("$routeChangeStart",function(event,next,current){var token=$cookieStore.get("brand"),bpk=$cookieStore.get("bpk");"/register"===$location.path()||"/register_success"===$location.path()||"/forget_pwd"===$location.path()||0===$location.path().indexOf("/activate")||(void 0===token||void 0===bpk)&&$rootScope.$evalAsync(function(){$location.path("/login")})})}),app.constant("order_categories",{unconfirm:0,underway:1,finish:2,cancel:3}),app.constant("goods_status",{"-1":"未确认",0:"未发货",1:"已发货",2:"已收货",3:"已取消"}),app.constant("payment_status",{0:"未付款",1:"订金已收",2:"全款已收"}),app.controller("GlobalCtrl",function($scope,$http,$location,$cookieStore,$window,$route,$routeParams,brandService){$scope.menuBooN=!1,$scope.menuboo=function(){return $scope.menuBooN},$scope.show_hide=function(){$scope.menuBooN?($(".menu").addClass("smallmenu"),$(".container,.container-1").addClass("smallmenu")):($(".menu").removeClass("smallmenu"),$(".container,.container-1").removeClass("smallmenu")),$scope.menuBooN=!$scope.menuBooN},$scope.NewBuyerShow=function(){$("#NewBuyer").show()},$scope.newBrand=function(){$("#newBrand").show()},$scope.hidenewBrand=function(){$("#newBrand").hide()},brandService.init($scope),$scope.isActive=function(loca){return loca===$location.path()},$scope.isOrderActive=function(){return"/orders_unconfirm"===$location.path()||"/orders_underway"===$location.path()||"/orders_finish"===$location.path()||"/orders_cancel"===$location.path()||"/orders_all"===$location.path()||"/orders_statistics"===$location.path()},$scope.showMenu2=function(event){var evt=$(event.currentTarget);$scope.menuBooN||(evt.siblings(".menuson").slideToggle("0.1"),evt.parent().addClass("activetwo"))};var token=$cookieStore.get("brand");token&&(brandService.get_profile(),brandService.get_brand_info(),brandService.get_brand_list()),$scope.new_brand=function(){var name=$("#NewBd_name").val(),create_time=$("#NewBd_time").val(),description=$("#NewBd_des").val(),post_data={name:name,create_time:create_time,description:description};return""===name?void $.msg_bre({content:"品牌名称不能为空"}):""===create_time?void $.msg_bre({content:"成立时间不能为空"}):void $http.post(host+"/brand/",post_data).success(function(data,status,headers,config){$cookieStore.remove("bpk"),$cookieStore.put("bpk",data.id),$("#newBrand").hide(),brandService.get_brand_info(),brandService.get_brand_list(),$location.path("/")}).error(function(data,status,headers,config){console.log(data)})},$scope.change_brand=function(id){$cookieStore.remove("bpk"),$cookieStore.put("bpk",id),brandService.get_brand_info(),$route.reload(),$location.path("/")},$scope.delete_brand=function(numid,numindex){$("#DeltBrand").show(),$scope.numid=numid,$scope.numindex=numindex},$scope.YDBrand=function(){$http["delete"](host+"/brand/"+$scope.numid+"/").success(function(data,status,headers,config){$scope.g_brand_list.splice($scope.numindex,1),$scope.change_brand($scope.g_brand_list[0].id)}).error(function(data,status,headers,config){console.log(data)}),$("#DeltBrand").hide()},$scope.NDBrand=function(){$("#DeltBrand").hide()},$scope.logout=function(){$http.get(host+"/logout/").success(function(data,status,headers,config){$cookieStore.remove("brand"),$cookieStore.remove("bpk"),$route.reload(),$location.path("/login")}).error(function(data,status,headers,config){console.log(data)})},$scope.send_message=function(){var msg=$("#message").val();if(""===msg)return void $.msg_bre({content:"不能发送空消息"});var post_data={content:msg};$http.post(host+"/suggestion/",post_data).success(function(data,status,headers,config){$.msg_bre({content:"留言发送成功"}),$("#message").val(""),$("#chatBox").hide(),$("#chatTool").show()}).error(function(data,status,headers,config){console.log(data)})},$scope.closeChatTool=function(){$scope.chatnum=!0,$("#chatBox").remove(),$("#chatTool").remove()},$scope.showchatBox=function(){$("#chatTool").hide(),$("#chatBox").show()},$scope.hidechatBox=function(){$("#chatBox").hide(),$("#chatTool").show()},$scope.showRelaDiv=function(e){var con="<span class='tipCont'></span>",tip=$(e.currentTarget).attr("data-tip");tip&&($(e.currentTarget).parent().addClass("RelaDiv"),$(e.currentTarget).before(con),$(e.currentTarget).siblings(".tipCont").html(tip),$(e.currentTarget).siblings(".tipCont").show())},$scope.hideRelaDiv=function(e){$(e.currentTarget).siblings(".tipCont").remove()};var myDate=new Date;$scope.p=function(time){return 10>time?"0"+time:time},$scope.nowTime=myDate.getFullYear()+"-"+$scope.p(myDate.getMonth()+1)+"-"+$scope.p(myDate.getDate())}).controller("HomeCtrl",function($scope,$http,$location,$cookieStore,brandService){var token=$cookieStore.get("brand");token&&(brandService.get_profile(),brandService.get_brand_info(),brandService.get_brand_list(),$http.get(host+"/studio/home/").success(function(data,status,headers,config){$scope.summary=data}).error(function(data,status,headers,config){console.log(data)}))}).controller("PopupCtrl",function($scope,$http,$location,$cookieStore){$scope.new_buyer=function(){var post_data={company:$scope.company,username:$scope.username,email:$scope.email,phone:$scope.phone,province:$("#province").val(),city:$("#city").val(),address:$scope.address,price_type:$scope.price_type,discount:$scope.discount,create_by_brand:!0};$http.post(host+"/studio/buyer/",post_data).success(function(data,status,headers,config){$.msg_bre({content:"新建买手成功"}),$("#NewBuyer").hide()}).error(function(data,status,headers,config){console.log(data)})},$scope.hide_new_buyer=function(){$("#NewBuyer").hide()},$(".distpicker").distpicker({province:" —— 所在省 ——",city:"—— 所在市 ——"})}).controller("ForgetPwdCtrl",function($scope,$http){$scope.send_email=function(){var post_data={username:$scope.email};$http.post(host+"/studio/forget_pwd/",post_data).success(function(data,status,headers,config){$.msg_bre({content:"请至邮箱查看邮件"}),$scope.avoidClick=!1}).error(function(data,status,headers,config){console.log(data),$scope.avoidClick=!1})},$scope.submitForm=function(isValid){isValid?($scope.avoidClick=!0,$scope.submitted="true",$scope.send_email()):$scope.submitted="false"}}).controller("StudioEditCtrl",function($scope,$http,cropService,brandService){cropService.init($scope,64,64,"/studio/update_avatar/",200,200,"avatar"),$http.get(host+"/studio/").success(function(data,status,headers,config){$scope.studio=data}).error(function(data,status,headers,config){console.log(data)}),$scope.submitted=!1,$scope.update_studio=function(m){$scope.submitted=!0,m&&($scope.avoidClick=!0,$http.put(host+"/studio/",$scope.studio).success(function(data,status,headers,config){brandService.set_username(data.username),$.msg_bre({content:"信息修改成功"}),$scope.avoidClick=!1}).error(function(data,status,headers,config){console.log(data),$scope.avoidClick=!1}))}}).controller("StudioPwdCtrl",function($scope,$http){$scope.change_pwd=function(){if($scope.avoidClick=!0,$scope.new_password!=$scope.new_password_confirm)return $.msg_bre({content:"两次新密码不一致"}),void($scope.avoidClick=!1);var post_data={old_password:$scope.old_password,new_password:$scope.new_password,new_password_confirm:$scope.new_password_confirm};$http.post(host+"/studio/update_password/",post_data).success(function(data,status,headers,config){$.msg_bre({content:"密码修改成功"}),$scope.avoidClick=!1}).error(function(data,status,headers,config){console.log(data),$scope.avoidClick=!1})}}).controller("OutputCtrl",function($scope,$http,$cookieStore){$("#start").datepicker({dateFormat:"yy-mm-dd"}),$("#end").datepicker({dateFormat:"yy-mm-dd"}),$scope.export_order=function(){var start=$("#start").val(),end=$("#end").val();if(""===start)return void $.msg_bre({content:"请选择开始时间"});var hiddenElement=document.createElement("a");hiddenElement.href=host+"/studio/export/orders/?start="+start+"&end="+end+"&token="+$cookieStore.get("brand"),hiddenElement.target="_blank",hiddenElement.download="订单.xlsx",hiddenElement.click()}}).controller("CouponCtrl",function($scope,$http){$scope.addCoupon=function(){$.msg_bre({inverse:!0,vanish:!1,model:"make.3",make:[{col:1,tag:"text","class":"txt discount",text:"",before:"折扣："},{col:2,tag:"text","class":"txt discount_number",text:"",before:"数量："},{col:3,tag:"confirm","class":"btn btn-com",text:"生成优惠券"},{col:3,tag:"cancel","class":"btn btn-cancel",text:"取消"}],msg_confirm:function(){$http.post(host+"/studio/coupons/",{amount:parseInt($(".discount_number").val()),discount:$(".discount").val(),last_time:"2015-9-1"}).success(function(data,status,headers,config){$scope.coupons.push.apply($scope.coupons,data.data),$("#check_all").attr("class",cb_check)}).error(function(data,status,headers,config){console.log(data)})}})},$scope.couponSelect=function(event,coupon){var evt=$(event.currentTarget);checkSingle(evt),coupon.checked=!coupon.checked},$scope.couponSelectAll=function(event){var evt=$(event.currentTarget),tar=$(".tb-coupon .icon-check, .tb-coupon .icon-checked");checkAll(evt,tar),evt.attr("class")==cb_check?angular.forEach($scope.coupons,function(i){i.checked=!1}):angular.forEach($scope.coupons,function(i){i.checked=!0})},$scope.delete_coupon=function(coupon_id,index){var json_data={ids:[coupon_id]};$http.put(host+"/studio/coupons/",json_data).success(function(data,status,headers,config){$scope.coupons.splice(index,1),$("#check_all").attr("class",cb_check)}).error(function(data,status,headers,config){console.log(data)})},$scope.delete_coupon_list=function(){for(var json_data={ids:[]},index2del=[],i=$scope.coupons.length-1;i>=0;i--)$scope.coupons[i].checked&&(json_data.ids.push($scope.coupons[i].id),index2del.push(i));$http.put(host+"/studio/coupons/",json_data).success(function(data,status,headers,config){angular.forEach(index2del,function(i){$scope.coupons.splice(i,1)}),$("#check_all").attr("class",cb_check)}).error(function(data,status,headers,config){console.log(data)})},$scope.status={0:"未使用",1:"已发送",2:"已使用"},$http.get(host+"/studio/coupons/").success(function(data,status,headers,config){$scope.coupons=data.data}).error(function(data,status,headers,config){console.log(data)})}).controller("CategoryCtrl",function($scope,$http){$scope.gender=1,$scope.cateSelect=function(event,c,gender){var evt=$(event.currentTarget);evt.parent(".btng").find(".selected").removeClass("selected"),evt.addClass("selected"),c.gender=gender},$scope.newCateSelect=function(event,gender){var evt=$(event.currentTarget);evt.parent(".btng").find(".selected").removeClass("selected"),evt.addClass("selected"),$scope.gender=gender},$scope.saveCate=function(){$.msg_bre({inverse:!0,vanish:!1,model:"make.2",make:[{col:1,tag:"text","class":"txt",text:"test2",before:"test:"},{col:2,tag:"confirm","class":"btn btn-com",text:"发送"},{col:2,tag:"cancel","class":"btn btn-cancel",text:"取消"}],msg_confirm:function(){}})},$http.get(host+"/category/").success(function(data,status,headers,config){$scope.categories=data}).error(function(data,status,headers,config){console.log(data)}),$scope.add_category=function(){if($scope.category){var post_data={name:$scope.category,gender:$scope.gender};$http.post(host+"/category/",post_data).success(function(data,status,headers,config){$scope.categories.push(data),$scope.category="",$(".msg-category-success").fadeIn().delay(1e3).fadeOut()}).error(function(data,status,headers,config){console.log(data)})}},$scope.delete_category=function(i,id){$http["delete"](host+"/category/"+id+"/").success(function(data,status,headers,config){$scope.categories.splice(i,1)}).error(function(data,status,headers,config){console.log(data)})},$scope.update_category=function(c){$http.put(host+"/category/"+c.id+"/",c).success(function(data,status,headers,config){console.log("update ok")}).error(function(data,status,headers,config){console.log(data)})}}).controller("CollectionCtrl",function($scope,$http){$scope.saveCollection=function(){$.msg_bre({content:"保存成功！"})},$http.get(host+"/collection/").success(function(data,status,headers,config){$scope.collections=data}).error(function(data,status,headers,config){console.log(data)}),$scope.add_collection=function(){var post_data={title:$scope.title,description:$scope.description};$http.post(host+"/collection/",post_data).success(function(data,status,headers,config){$scope.collections.push(data),$scope.title="",$scope.description=""}).error(function(data,status,headers,config){console.log(data)})},$scope.update_collection=function(c){$http.put(host+"/collection/"+c.id+"/",c).success(function(data,status,headers,config){$.msg_bre({content:"保存成功！"})}).error(function(data,status,headers,config){console.log(data)})},$scope.delete_collection=function(i,id){$http["delete"](host+"/collection/"+id+"/").success(function(data,status,headers,config){$scope.collections.splice(i,1)}).error(function(data,status,headers,config){console.log(data)})},$scope.show_detail=function(event){var evt=$(event.currentTarget),tar=evt.closest(".table-list").find(".col-detail"),state=tar.css("display");"none"==state?tar.slideDown():tar.slideUp()}}).controller("ProductCtrl",function($scope,$http,$routeParams,$location){$(window).scroll(function(){$(this).scrollTop()>300?$(".scrolltop:hidden").stop(!0,!0).fadeIn():$(".scrolltop").stop(!0,!0).fadeOut()}),$(function(){$(".scroll").click(function(){return $("html,body").animate({scrollTop:$(".container").offset().top},"1000"),!1})}),$http.get(host+"/products/"+$routeParams.product_id+"/").success(function(data,status,headers,config){$scope.product=data,$scope.tags=data.tags.join(","),$scope.product.composition=$scope.product.composition.replace(/\n/g,"<br/>"),$scope.product.description=$scope.product.description.replace(/\n/g,"<br/>"),$scope.pre_order=$scope.product.pre_order?"是":"否"}).error(function(data,status,headers,config){console.log(data)}),$scope.edit_product=function(product_id){$location.path("/products/"+product_id+"/edit")},$scope.delete_product=function(product_id){$http["delete"](host+"/products/"+product_id+"/").success(function(data,status,headers,config){$location.path("/product_manage/")}).error(function(data,status,headers,config){console.log(data)})},$(function(){var targetDiv=$("#delete-product");targetDiv.dialog({dialogClass:"no-close",autoOpen:!1,appendTo:".product-info",width:"345px",resizable:!1,modal:!0,closeOnEscape:!1,buttons:{"删除":function(){$scope.delete_product($scope.product.id),$(this).dialog("close")},"取消":function(){$(this).dialog("close")}},close:function(){$(this).hide()}})}),$scope.confirm_delete=function(){$("#delete-product").dialog("open"),$(".ui-dialog :button").blur()}}).controller("ProductEditCtrl",function($scope,$http,$routeParams,$location,cropService){$(".l-image-upload ,.s-image-upload").hover(function(){$(this).find(".icon-delete-button").show(300)},function(){$(this).find(".icon-delete-button").hide()}),$scope.category_show_hide=function(){$scope.product.online_sale=!$scope.product.online_sale,$(".checkbox").toggleClass("icon-right")},$scope.nextdiv_show=function(){$(".nextdiv").slideToggle("fast")},$scope.nextdiv_post=function(v){$scope.product.gender=v,$(".nextdiv").hide()},$scope.collshow_hide=function(){$(".ccshow").slideToggle("fast")},$scope.popAdd_show=function(){$("#popAddColl").show()},$scope.popAdd_hide=function(){$("#popAddColl").hide()},$scope.hidePost=function(i){$scope.product.collection=i.id,$(".ccshow").hide()},$scope.add_collection=function(){var post_data={title:$scope.col_title,description:$scope.col_description};$http.post(host+"/collection/",post_data).success(function(data,status,headers,config){$scope.collections.push(data),$scope.collections_dict[data.id]=data.title,$scope.col_title="",$scope.col_description="",$("#popAddColl").hide()}).error(function(data,status,headers,config){console.log(data),$("#popAddColl").hide()})},$scope.$watch("product",function(newValue,oldValue){oldValue&&($scope.product_changed=!0)},!0),$scope.$on("$locationChangeStart",function(event,next,current){$scope.flag||($scope.product_changed===!0||$scope.image1||$scope.image2||$scope.image3||$scope.image4||$scope.image5)&&(event.preventDefault(),$("#dontsave").show(),$scope.flag=!0)}),$scope.backsave=function(){$("#dontsave").hide(),history.back()},$scope.hidedts=function(){$("#dontsave").hide(),$scope.flag=!1},$(".lastbuy-time").datepicker({dateFormat:"yy-mm-dd",minDate:new Date}),$http.get(host+"/products/"+$routeParams.product_id+"/").success(function(data,status,headers,config){$scope.product=data,$scope.product.tags=$scope.product.tags.join(","),$scope.product.collection=$scope.product.collection.id,$scope.product.online_sale&&$(".checkbox").toggleClass("icon-right"),$scope.product.allow_discount=$scope.product.allow_discount.toString(),$scope.product.last_order_time&&($scope.product.last_order_time=$scope.product.last_order_time.split("T")[0])}).error(function(data,status,headers,config){console.log(data)}),$http.get(host+"/collection/").success(function(data,status,headers,config){$scope.collections=data,$scope.collections_dict={},angular.forEach(data,function(i){$scope.collections_dict[i.id]=i.title})}).error(function(data,status,headers,config){console.log(data)});var update_image=function(i,img,is_primary){var product_img=$scope.product.images[i],post_data={image:img,is_primary:is_primary,product:$scope.product.id};product_img?$http.put(host+"/product/images/"+product_img.pk+"/",post_data).success(function(data,status,headers,config){$scope.product.images[i]=data}).error(function(data,status,headers,config){console.log(data)}):$http.post(host+"/product/images/",post_data).success(function(data,status,headers,config){$scope.product.images[i]=data}).error(function(data,status,headers,config){console.log(data)})};cropService.init($scope,120,120,"",1e3,1e3,""),$scope.crop_image=function(){cropService.upload_product_image($scope,1e3,1e3)},$scope.$watch("image2",function(newValue,oldValue){$scope.product&&update_image(1,newValue,!1)}),$scope.$watch("image3",function(newValue,oldValue){$scope.product&&update_image(2,newValue,!1)}),$scope.$watch("image4",function(newValue,oldValue){$scope.product&&update_image(3,newValue,!1)}),$scope.$watch("image5",function(newValue,oldValue){$scope.product&&update_image(4,newValue,!1)}),$scope.delete_image=function(pk,i){$http["delete"](host+"/product/images/"+pk+"/").success(function(data,status,headers,config){$scope.product.images[i]=null}).error(function(data,status,headers,config){console.log(data)})},$scope.add_size=function(){if(0===$scope.product.sizes.length||null!==$scope.product.sizes[$scope.product.sizes.length-1].size){var sku="";$scope.product.sizes.length>=1&&(sku=$scope.product.sizes[$scope.product.sizes.length-1].sku),$scope.product.sizes.push({size:"",description:"",sku:sku,barcode:"",retail:0,wholesale:1})}},$scope.delete_size=function(size,i){size.id?size.deleted=!0:$scope.product.sizes.splice(i,1)},$scope.add_wholesale_prices=function(){$scope.product.wholesale_prices.push({min_number:$scope.min_number,max_number:$scope.max_number,price:$scope.price}),$scope.min_number="",$scope.max_number=0,$scope.price=""},$scope.delete_wholesale_prices=function(price,i){price.id?price.deleted=!0:$scope.product.wholesale_prices.splice(i,1)},$scope.change_wholesale_size=function(size,event){""===size.wholesale?(size.wholesale=1,$(event.currentTarget).removeClass("normalstyle"),$(event.currentTarget).addClass("closestyle")):(size.wholesale="",$(event.currentTarget).removeClass("closestyle"),$(event.currentTarget).addClass("normalstyle"))},$scope.update_product=function(product_id,isValid,isValid2){if($scope.flag=!0,$scope.avoidClick=!0,$scope.submitted=!0,isValid&&isValid2||isValid&&!isValid2&&!$scope.product.online_sale){"string"==typeof $scope.product.tags&&($scope.product.tags=$scope.product.tags.split(/,|，/));var t=$(".lastbuy-time").val();t&&($scope.product.last_order_time=t,-1===t.indexOf(" ")&&($scope.product.last_order_time+=" 00:00:00")),""===$scope.product.last_order_time&&($scope.product.last_order_time=null),void 0===$scope.product.wholesale_price&&($scope.product.wholesale_price=null),$http.put(host+"/products/"+product_id+"/",$scope.product).success(function(data,status,headers,config){$location.path("/products/"+product_id)}).error(function(data,status,headers,config){console.log(data),$scope.avoidClick=!1})}else isValid?!isValid2&&$scope.product.online_sale&&($("html,body").animate({scrollTop:$("#newProductForm2").offset().top-80},"500"),$scope.avoidClick=!1):($("html,body").animate({scrollTop:$("#newProductForm").offset().top-80},"800"),$scope.avoidClick=!1)}}).controller("NewProductCtrl",function($scope,$http,$location,$timeout,cropService,checkService){$scope.category_show_hide=function(){$scope.product.online_sale=!$scope.product.online_sale,$(".checkbox").toggleClass("icon-right")},$(".lastbuy-time").datepicker({dateFormat:"yy-mm-dd",minDate:new Date}),$scope.ice_category="",$scope.online_category="",$scope.air_category="",$scope.product={name:"",gender:"",catagory:"",color:"",price:"",online_sale:!1,model_height:0,model_weight:0,collection:"",composition:"",weight:0,pre_order:!1,pre_order_number:0,last_order_time:null,delivery:"",payment_term:0,return_term:"TODO",description:"",category:[],images:[],sizes:[],tags:""},cropService.init($scope,250,250,"",1e3,1e3,""),$scope.crop_image=function(){cropService.crop_image($scope,1e3,1e3),console.log($scope.image1)},$scope.nextdiv_show=function(){$(".nextdiv").slideToggle("fast")},$scope.nextdiv_post=function(v){$scope.product.gender=v,$(".nextdiv").hide()},$scope.collshow_hide=function(){$(".ccshow").slideToggle("fast")},$scope.popAdd_show=function(){$("#popAddColl").show()},$scope.popAdd_hide=function(){$("#popAddColl").hide()},$scope.hidePost=function(i){$scope.product.collection=i.id,$(".ccshow").hide()},$scope.$watch("product",function(newValue,oldValue){newValue!=oldValue&&($scope.product_changed=!0)},!0),$scope.$on("$locationChangeStart",function(event,next,current){($scope.product_changed===!0||$scope.image1||$scope.image2||$scope.image3||$scope.image4||$scope.image5)&&(event.preventDefault(),$("#dontsave").show())}),$scope.backsaveT=function(){$scope.product_changed=!1,$scope.image1=$scope.image2=$scope.image3=$scope.image4=$scope.image5=null,$("#dontsave").hide(),history.back()},$scope.hidedtsT=function(){$("#dontsave").hide()},$http.get(host+"/collection/").success(function(data,status,headers,config){$scope.collections=data,$scope.collections_dict={},angular.forEach(data,function(i){$scope.collections_dict[i.id]=i.title})}).error(function(data,status,headers,config){console.log(data)}),$scope.add_wholesale_prices=function(){$scope.product.wholesale_prices.push({min_number:$scope.min_number,max_number:$scope.max_number,price:$scope.wholesale_price})},$scope.delete_wholesale_prices=function(i){$scope.product.wholesale_prices.splice(i,1)},$scope.add_size=function(){if(0===$scope.product.sizes.length||null!==$scope.product.sizes[$scope.product.sizes.length-1].size){var sku="";$scope.product.sizes.length>=1&&(sku=$scope.product.sizes[$scope.product.sizes.length-1].sku),$scope.product.sizes.push({size:null,description:"",sku:sku,barcode:"",retail:0,wholesale:1})}},$scope.delete_size=function(i){$scope.product.sizes.splice(i,1)},$scope.change_wholesale_size=function(size,event){""===size.wholesale?(size.wholesale=1,$(event.currentTarget).removeClass("normalstyle"),$(event.currentTarget).addClass("closestyle")):(size.wholesale="",$(event.currentTarget).removeClass("closestyle"),$(event.currentTarget).addClass("normalstyle"))},$scope.add_extra=function(){$scope.product.extra.push({key:$scope.key,description:$scope.description})},$scope.delete_extra=function(i){$scope.product.extra.splice(i,1)},$scope.add_collection=function(){var post_data={title:$scope.col_title,description:$scope.col_description};$http.post(host+"/collection/",post_data).success(function(data,status,headers,config){$scope.collections.push(data),$scope.collections_dict[data.id]=data.title,$scope.col_title="",$scope.col_description="",$("#popAddColl").hide()}).error(function(data,status,headers,config){console.log(data),$("#popAddColl").hide()})},$scope.new_product=function(e,isValid,isValid2){if(null===$scope.image1||void 0===$scope.image1)return void $.msg_bre({content:"请选择商品大图"});if($scope.submitted=!0,isValid(isValid2||!isValid2&&!$scope.product.online_sale)){if(!checkService.checkUsable($(e.currentTarget)))return;"string"==typeof $scope.product.tags&&($scope.product.tags=$scope.product.tags.split(/,|，/)),$scope.product.images=[$scope.image1,$scope.image2,$scope.image3,$scope.image4,$scope.image5];var t=$(".lastbuy-time").val();t&&($scope.product.last_order_time=t,-1===t.indexOf(" ")&&($scope.product.last_order_time+=" 00:00:00")),void 0===$scope.product.wholesale_price&&($scope.product.wholesale_price=null),$http.post(host+"/products/",$scope.product).success(function(data,status,headers,config){$scope.product_changed=!1,$scope.image1=$scope.image2=$scope.image3=$scope.image4=$scope.image5=null,$location.path("/products/"+data)}).error(function(data,status,headers,config){console.log(data),checkService.doAfterAction($(e.currentTarget))})}else isValid?!isValid2&&$scope.product.online_sale&&$("html,body").animate({scrollTop:$("#newProductForm2").offset().top-80},"500"):$("html,body").animate({scrollTop:$("#newProductForm").offset().top-80},"800")}}).controller("LoginCtrl",function($scope,$http,$cookieStore,$location){$scope.login=function(){$http.post(host+"/login/",{username:$scope.username,password:$scope.password}).success(function(data,status,headers,config){$cookieStore.put("brand",data.token),$cookieStore.put("bpk",data.bpk),$location.path("/")}).error(function(data,status,headers,config){console.log(data),$scope.avoidClick=!1})},$scope.submitForm=function(isValid){isValid?($scope.avoidClick=!0,$scope.submitted="true",$scope.login()):$scope.submitted="false"}}).controller("RegisterCtrl",function($scope,$http,$location,sharedProperties){$scope.username="",$scope.password="",$scope.password_confirm="",$scope.submitForm=function(isValid){isValid?($scope.submitted="true",$scope.password==$scope.password_confirm&&($scope.register(),$scope.avoidClick=!0)):$scope.submitted="false"},$scope.register=function(){$http.post(host+"/studio/register/",{username:$scope.username,email:$scope.username,password:$scope.password}).success(function(data,status,headers,config){sharedProperties.set_email($scope.username),$location.path("/register_success")}).error(function(data,status,headers,config){console.log(data),$scope.avoidClick=!1})}}).controller("RegisterSuccessCtrl",function($scope,$http,$location,$interval,sharedProperties){$scope.email=sharedProperties.get_email();var emailCompany={"qq.com":"http://mail.qq.com","gmail.com":"http://mail.google.com","sina.com":"http://mail.sina.com.cn","163.com":"http://mail.163.com","126.com":"http://mail.126.com","yeah.net":"http://www.yeah.net/","sohu.com":"http://mail.sohu.com/","tom.com":"http://mail.tom.com/","sogou.com":"http://mail.sogou.com/","139.com":"http://mail.10086.cn/","hotmail.com":"http://www.hotmail.com","live.com":"http://login.live.com/","live.cn":"http://login.live.cn/","live.com.cn":"http://login.live.com.cn","189.com":"http://webmail16.189.cn/webmail/",
"yahoo.com.cn":"http://mail.cn.yahoo.com/","yahoo.cn":"http://mail.cn.yahoo.com/","eyou.com":"http://www.eyou.com/","21cn.com":"http://mail.21cn.com/","188.com":"http://www.188.com/","foxmail.coom":"http://www.foxmail.com"};$scope.gotoEmailCom=function(){var url=$scope.email.split("@")[1];for(var i in emailCompany)$(".activateEmail").attr("href",emailCompany[url])},$scope.gotoEmailCom(),$scope.waitTime=!0,$scope.countDown=function(){$scope.secClock=function(){return $scope.m>0?void $scope.m--:($scope.waitTime=!0,$interval.cancel($scope.clock),!1)},$scope.clock=$interval($scope.secClock,1e3)},$scope.avoidClick=!1,$scope.resend_activate=function(){return $scope.avoidClick=!0,$http.post(host+"/studio/resend_code/",{email:sharedProperties.get_email()}).success(function(data,status,headers,config){$scope.uese=data.data,$.msg_bre({content:"邮件发送成功!"}),$scope.avoidClick=!1,$scope.waitTime=!1,$scope.m=60,$scope.countDown()}).error(function(data,status,headers,config){$scope.avoidClick=!1,console.log(data)}),!1}}).controller("StatisticCtrl",function($scope,$http,$location,$routeParams){}).controller("ActivateCtrl",function($scope,$http,$location,$routeParams){$http.post(host+"/studio/auth_activate/",{code:$routeParams.code}).success(function(data,status,headers,config){$scope.id=data.id}).error(function(data,status,headers,config){$location.path("/register")}),$scope.update_data=function(formValid){$scope.submitted=!0,formValid&&($scope.avoidClick=!0,$http.put(host+"/studio/auth_activate/",{id:$scope.id,name:$scope.name,description:$scope.description,username:$scope.username,phone:$scope.phone,create_time:$scope.create_time}).success(function(data,status,headers,config){$location.path("/login"),$scope.avoidClick=!1}).error(function(data,status,headers,config){console.log(data),$scope.avoidClick=!1}))}}).controller("ResetPwdCtrl",function($scope,$http,$location,$routeParams){$scope.reset_pwd=function(){return $scope.new_password_confirm!=$scope.new_password?void $.msg_bre({content:"两次新密码不一致"}):void $http.post(host+"/studio/reset_pwd/",{code:$routeParams.code,new_password:$scope.new_password}).success(function(data,status,headers,config){$location.path("/login")}).error(function(data,status,headers,config){console.log(data)})}}).controller("StudioCtrl",function($scope,$http,$location,$routeParams){$http.get(host+"/studio/").success(function(data,status,headers,config){$scope.studio=data,$scope.studio.avatar=host+"/static/"+$scope.studio.avatar}).error(function(data,status,headers,config){console.log(data)}),$scope.edit_studio=function(studio_id){$location.path("/studio/"+studio_id+"/edit")}}).controller("BrandCtrl",function($scope,$http,$location,$cookieStore,$routeParams,cropService,brandService){cropService.init($scope,300,65,"",300,65,""),$scope.cur_brand_id=$routeParams.brand_id,$scope.crop_image=function(){cropService.upload_brand_image($scope,300,65,$routeParams.brand_id)},$http.get(host+"/brand/"+$routeParams.brand_id+"/").success(function(data,status,headers,config){$scope.brand=data}).error(function(data,status,headers,config){console.log(data)}),$scope.updateBrand=function(){$scope.avoidClick=!0,$http.put(host+"/brand/"+$routeParams.brand_id+"/",$scope.brand).success(function(data,status,headers,config){$.msg_bre({content:"保存成功！"}),$scope.avoidClick=!1}).error(function(data,status,headers,config){$.msg_bre({content:data}),$scope.avoidClick=!1})}}).controller("StylistCtrl",function($scope,$http,$location,$routeParams,cropService){$scope.cur_brand_id=$routeParams.brand_id,$http.get(host+"/brand/"+$scope.cur_brand_id+"/designer/").success(function(data,status,headers,config){$scope.stylist=data}).error(function(data,status,headers,config){console.log(data)}),$scope.new_stylist=function(){var json_data={name:$scope.name,summary:$scope.summary,brand:$routeParams.brand_id};$http.post(host+"/brand/"+$scope.cur_brand_id+"/designer/",json_data).success(function(data,status,headers,config){$scope.stylist.push(data),$scope.name="",$scope.summary=""}).error(function(data,status,headers,config){console.log(data)})},$scope.delete_stylist=function(i,id){$http["delete"](host+"/brand/"+$scope.cur_brand_id+"/designer/"+id+"/").success(function(data,status,headers,config){$scope.stylist.splice(i,1)}).error(function(data,status,headers,config){console.log(data)})},$scope.update_stylist=function(d){$http.put(host+"/brand/"+$scope.cur_brand_id+"/designer/"+d.id+"/",d).success(function(data,status,headers,config){$.msg_bre({content:"保存成功！"})}).error(function(data,status,headers,config){console.log(data)})}}).controller("CodeCtrl",function($scope,$http,$location,$route){$scope.addCode=function(){$.msg_bre({inverse:!0,vanish:!1,model:"make.2",make:[{col:1,tag:"text","class":"txt code_num",before:"生成的数量："},{col:2,tag:"confirm","class":"btn btn-com",text:"生成"},{col:2,tag:"cancel","class":"btn btn-cancel",text:"取消"}],msg_confirm:function(){$http.post(host+"/studio/code/",{num:parseInt($(".code_num").val())}).success(function(data,status,headers,config){$scope.code_list.push.apply($scope.code_list,data.data),$("#check_all").attr("class",cb_check)}).error(function(data,status,headers,config){console.log(data)})}})},$scope.delete_code=function(code_id,index){var json_data={ids:[code_id]};$http.put(host+"/studio/code/",json_data).success(function(data,status,headers,config){$scope.code_list.splice(index,1),$("#check_all").attr("class",cb_check)}).error(function(data,status,headers,config){console.log(data)})},$scope.delete_code_list=function(){for(var json_data={ids:[]},index2del=[],i=$scope.code_list.length-1;i>=0;i--)$scope.code_list[i].checked&&(json_data.ids.push($scope.code_list[i].id),index2del.push(i));$http.put(host+"/studio/code/",json_data).success(function(data,status,headers,config){angular.forEach(index2del,function(i){$scope.code_list.splice(i,1)}),$("#check_all").attr("class",cb_check)}).error(function(data,status,headers,config){console.log(data)})},$scope.code_status={"false":"未使用","true":"已使用"},$http.get(host+"/studio/code/").success(function(data,status,headers,config){$scope.code_list=data.data}).error(function(data,status,headers,config){console.log(data)}),$scope.codeSelect=function(event,code){var evt=$(event.currentTarget);checkSingle(evt),code.checked=!code.checked},$scope.codeSelectAll=function(event){var evt=$(event.currentTarget),tar=$(".tb-code .icon-check, .tb-code .icon-checked");checkAll(evt,tar),evt.attr("class")==cb_check?angular.forEach($scope.code_list,function(i){i.checked=!1}):angular.forEach($scope.code_list,function(i){i.checked=!0})}}).controller("BuyerListCtrl",function($scope,$http,$location,$route,buyerService){$scope.order_by="index",$scope.reverse=!0,$scope.order=function(order_by){$scope.reverse=$scope.order_by===order_by?!$scope.reverse:!1,$scope.order_by=order_by},$scope.filter_reset=function(){reset()};var reset=function(){$scope.status={unverified:"",verified:""},$scope.price_type={retail_based:"",wholesale_based:""},$scope.filter_data={company:"",username:"",email:"",phone:"",city:"",status:[],price_type:[]}};reset(),$scope.category_show=!1,$scope.category_show_hide=function(){$scope.category_show=!$scope.category_show,$(".checkbox").toggleClass("icon-right")},$scope.delete_buyers=function(){json_data={ids:[]},index2del=[];for(var i=$scope.buyer_list.length-1;i>=0;i--)$scope.buyer_list[i].checked&&(json_data.ids.push($scope.buyer_list[i].id),index2del.push(i));$http.put(host+"/studio/group/",json_data).success(function(data,status,headers,config){angular.forEach(index2del,function(i){$scope.buyer_list.splice(i,1)})}).error(function(data,status,headers,config){console.log(data)})},$scope.filter_buyer=function(){$scope.avoidClick=!0,$scope.filter_data.price_type=[],angular.forEach($scope.price_type,function(v,k){""!==v&&$scope.filter_data.price_type.push(v)}),$scope.filter_data.status=[],angular.forEach($scope.status,function(v,k){""!==v&&$scope.filter_data.status.push(v)}),buyerService.filter_buyer($scope)};var delDialog=function(buyer,i,userName){var targetDiv=$("#unverify"+buyer);targetDiv.dialog({dialogClass:"no-close",autoOpen:!1,appendTo:".wrapper",width:"345px",resizable:!1,modal:!0,buttons:{"确认":function(){$scope.unverify(buyer,i,userName),$(this).dialog("close")},"返回":function(){$(this).dialog("close")}},close:function(){$(this).hide()}})};$scope.del_buyer=function(buyer,i,userName){$(delDialog(buyer,i,userName)),$("#unverify"+buyer).dialog("open"),$(".ui-dialog :button").blur()},$scope.unverify=function(buyer,i,userName){$http["delete"](host+"/studio/group/"+buyer+"/").success(function(data,status,headers,config){$scope.buyer_list.splice(i,1),$.msg_bre({content:"删除成功"})}).error(function(data,status,headers,config){console.log(data)})},$scope.refuse=function(buyer,i,userName){$http["delete"](host+"/studio/group/"+buyer.id+"/").success(function(data,status,headers,config){$scope.buyer_list.splice(i,1),$.msg_bre({content:"未接受关联"})}).error(function(data,status,headers,config){console.log(data)})},$scope.verify=function(buyer,userName){buyer.status=1,$http.put(host+"/studio/group/"+buyer.id+"/",buyer).success(function(data,status,headers,config){buyer.status=1,$.msg_bre({content:"您已与"+userName+"关联"})}).error(function(data,status,headers,config){console.log(data)})},buyerService.get_buyer_list($scope)}).controller("BuyerDetailCtrl",function($scope,$http,$location,$routeParams){$scope.show_detail=!1,$http.get(host+"/studio/group/"+$routeParams.buyer_id+"/").success(function(data,status,headers,config){$scope.buyer=data,$scope.show_detail=!$scope.buyer.create_by_brand}).error(function(data,status,headers,config){console.log(data)});var accDialog=function(){var targetDiv=$("#confirmAccept");targetDiv.dialog({dialogClass:"no-close",autoOpen:!1,appendTo:".wrapper",width:"345px",resizable:!1,modal:!0,buttons:{"确认":function(){$scope.verify(),$(this).dialog("close")},"返回":function(){$(this).dialog("close")}},close:function(){$(this).hide()}})};$scope.confirmAccept=function(){$(accDialog()),$("#confirmAccept").dialog("open"),$(".ui-dialog :button").blur()};var refDialog=function(){var targetDiv=$("#confirmRefuse");targetDiv.dialog({dialogClass:"no-close",autoOpen:!1,appendTo:".wrapper",width:"345px",resizable:!1,modal:!0,buttons:{"确认":function(){$scope.unverify(),$(this).dialog("close")},"返回":function(){$(this).dialog("close")}},close:function(){$(this).hide()}})};$scope.confirmRefuse=function(){$(refDialog()),$("#confirmRefuse").dialog("open"),$(".ui-dialog :button").blur()},$scope.verify=function(){$scope.buyer.status=1,$http.put(host+"/studio/group/"+$scope.buyer.id+"/",$scope.buyer).success(function(data,status,headers,config){$scope.buyer=data}).error(function(data,status,headers,config){console.log(data)})},$scope.update=function(){$scope.avoidClick=!0,$scope.buyer.status=1,$http.put(host+"/studio/group/"+$scope.buyer.id+"/",$scope.buyer).success(function(data,status,headers,config){$scope.buyer=data,$.msg_bre({content:"保存成功！"}),$scope.avoidClick=!1}).error(function(data,status,headers,config){console.log(data),$scope.avoidClick=!1})},$scope.unverify=function(){$http["delete"](host+"/studio/group/"+$scope.buyer.id+"/").success(function(data,status,headers,config){$location.path("/buyer_list")}).error(function(data,status,headers,config){console.log(data)})},$scope.editbuyer=!1,$scope.Edit_Buyer=function(){$scope.editbuyer=!0,$(".distpicker").distpicker({province:$scope.buyer.province,city:$scope.buyer.city})},$scope.price_type={0:"以零售价为基准",1:"以打折价为基准"},$scope.Save_Buyer=function(isValid){$scope.editbuyer=!1,$scope.avoidClick=!0,$scope.buyer.province=$("#province").val(),$scope.buyer.city=$("#city").val(),$http.put(host+"/studio/buyer/"+$scope.buyer.pk+"/",$scope.buyer).success(function(data,status,headers,config){$scope.buyer=data,$.msg_bre({content:"保存成功！"}),$scope.avoidClick=!1}).error(function(data,status,headers,config){console.log(data),$scope.avoidClick=!1})},$scope.Delete_Buyer=function(){$scope.unverify()}}).controller("AnnouncementDetailCtrl",function($scope,$http,$location,$routeParams){$http.get(host+"/common/announce/"+$routeParams.id+"/").success(function(data,status,headers,config){$scope.announcement=data.data}).error(function(data,status,headers,config){console.log(data)})}).controller("MessagesCtrl",function($scope,$http,$location,$routeParams){$http.get(host+"/common/message/?type=1").success(function(data,status,headers,config){$scope.data=data.data}).error(function(data,status,headers,config){console.log(data)});var scrollWin=function(){var DIV=$(".user-say-body-container");DIV.animate({scrollTop:1e4},10)};$scope.mark_read=function(id){var post_data={pk:id};$http.put(host+"/common/noreadmessage/",post_data).success(function(data,status,headers,config){$scope.data.unread-=data.number}).error(function(data,status,headers,config){console.log(data)})},$scope.trigger_reply=function(m){m.show_reply=!m.show_reply,$(".user-say").show(),scrollWin(),m.show_reply&&($scope.mark_read(m.id),$(".user-say").hide())},$scope.send_message=function(m){if($scope.avoidClick=!0,void 0===m.reply||""===m.reply)return $.msg_bre({content:"不能发送空内容"}),void($scope.avoidClick=!1);var post_data={type:m.type,pk:m.id,receiver:m.sender_id,message:m.reply};$http.post(host+"/common/message/",post_data).success(function(data,status,headers,config){m.reply="",m.message.push(data.data),scrollWin(),$scope.avoidClick=!1}).error(function(data,status,headers,config){console.log(data),$scope.avoidClick=!1})},$scope.new_message=function(){var post_data={content:$scope.message};$http.post(host+"/common/noreadmessage/",post_data).success(function(data,status,headers,config){$scope.categories.push(data)}).error(function(data,status,headers,config){console.log(data)})}}),$(function(){$(document).keydown(function(event){13!=event.keyCode||$("textarea").is(event.target)||0!==$("textarea").has(event.target).length||$(".enterClick").click()}),$(".fancybox-effects-d").fancybox({padding:0,openEffect:"elastic",openSpeed:150,closeEffect:"elastic",closeSpeed:150,closeClick:!0,helpers:{overlay:null}})});var cb_check="icon icon-check",cb_checked="icon icon-checked";app.controller("ordersNewCtrl",function($scope,$http,$location,$route,buyerService,productService){$scope.changeby=!1,$scope.new_by=function(){$("#NewBuyer").show()},$scope.chose_buyer=function(){$("#ChoseBuyer").show(),$("#addGoods").hide(),buyerService.get_buyer_list($scope)},$scope.change_buyer=function(){$("#ChoseBuyer").show()},$scope.hide_chose_buyer=function(){$("#ChoseBuyer").hide()},$scope.choice_finish=!1,$scope.chose_buyer_sure=function(){$scope.changeby=!0,$("#ChoseBuyer").hide(),$scope.choice_finish=!0},$scope.pickon_buyer=function(){},$scope.add_goods=function(){$("#addGoods").show(),$("#ChoseBuyer").hide(),productService.get_product_list($scope),productService.get_collections($scope)},$scope.hide_addGoods=function(){$("#addGoods").hide()},$scope.new_order=function(){},$scope.show_goods_box=!1,$scope.add_goods_sure=function(){$scope.show_goods_box=!0,$("#addGoods").hide()},$(".distpicker").distpicker({province:" —— 所在省 ——",city:"—— 所在市 ——"})}).controller("OrdersUnconfirmCtrl",function($scope,$http,$location,$route,$routeParams,order_categories,goods_status,payment_status){$scope.checked_id=[],$scope.headChecked=!1,$scope.SelectAll=function(list){$scope.headChecked=!$scope.headChecked,Select_All(list,$scope.checked_id,$scope.headChecked)},$scope.SelectOne=function(i){Select_One(i,$scope.checked_id)},$scope.newWindow=function(){new_Window($scope.checked_id)},$scope.order_by="index",$scope.reverse=!0,$scope.order=function(order_by){$scope.reverse=$scope.order_by===order_by?!$scope.reverse:!1,$scope.order_by=order_by};var newDialog=function(m,n){var targetDiv=$("#canceldd"+n);targetDiv.dialog({dialogClass:"no-close",autoOpen:!1,appendTo:"body",resizable:!1,width:"40%",modal:!0,buttons:{"确认":function(){$scope.cancel_order(m,n),$(this).dialog("close")},"返回":function(){$(this).dialog("close")}},close:function(){$(this).hide()}})};$scope.confirm_cancel=function(m,n){$(newDialog(m,n)),$("#canceldd"+n).dialog("open"),$(".ui-dialog :button").blur()};var newMoneyDialog=function(m,n){var targetDiv=$("#money-confirm"+n);targetDiv.dialog({dialogClass:"no-close",autoOpen:!1,appendTo:".ddqk",width:"345px",resizable:!1,modal:!0,buttons:{"确认":function(){$scope.confirm_payment(m),$(this).dialog("close")},"返回":function(){$(this).dialog("close")}},close:function(){$(this).hide()}})};$scope.confirm_money=function(m,n){$(newMoneyDialog(m,n)),$("#money-confirm"+n).dialog("open"),$(".ui-dialog :button").blur()},$scope.show=!1,$scope.choose=function(){$scope.show=!$scope.show},$http.get(host+"/studio/order/?category="+order_categories.unconfirm).success(function(data,status,headers,config){$scope.order_list=data.data}).error(function(data,status,headers,config){console.log(data)}),$scope.delivery=function(i){i.wait_visible=!0},$scope.cancel_deliver=function(i){i.wait_visible=!1},$scope.show_confirm=function(i){$scope.win_visible=!0},$scope.cancel_order=function(i,index){var data={cancel:!0};$http.put(host+"/studio/order/"+i.id+"/",data).success(function(data,status,headers,config){i.goods_status=3,$scope.order_list.splice(index,1)}).error(function(data,status,headers,config){console.log(data)})},$scope.confirm_payment=function(i){var data={payment_status:1};$http.put(host+"/studio/order/"+i.id+"/",data).success(function(data,status,headers,config){i.payment_status=1}).error(function(data,status,headers,config){console.log(data)})},$scope.confirm_delivery=function(i){var data={confirm:1,delivery:i.delivery,express_num:i.express_num};$http.put(host+"/studio/order/"+i.id+"/",data).success(function(data,status,headers,config){i.goods_status=1,i.wait_visible=!1}).error(function(data,status,headers,config){console.log(data)})},$scope.filter_orders=function(){$http.post(host+"/studio/orderfilter/",$scope.filter_data).success(function(data,status,headers,config){$scope.order_list=data.data,$.msg_bre({content:"搜索完成"})}).error(function(data,status,headers,config){console.log(data)})}}).controller("OrdersUnderwayCtrl",function($scope,$http,$location,$route,$routeParams,order_categories,goods_status,payment_status){$scope.checked_id=[],$scope.headChecked=!1,$scope.SelectAll=function(list){$scope.headChecked=!$scope.headChecked,Select_All(list,$scope.checked_id,$scope.headChecked)},$scope.SelectOne=function(i){Select_One(i,$scope.checked_id)},$scope.newWindow=function(){new_Window($scope.checked_id)},$scope.order_by="index",$scope.reverse=!0,$scope.order=function(order_by){$scope.reverse=$scope.order_by===order_by?!$scope.reverse:!1,$scope.order_by=order_by},$(".finish-time-from,.finish-time-to,.deal-time-from,.deal-time-to").datepicker({dateFormat:"yy-mm-dd"}),$scope.goods_status=goods_status,$scope.payment_status=payment_status,$scope.order_reset=function(){reset()};var reset=function(){$scope.goods_status_filter={not_confirmed:"",not_delivery:"",delivery:"",done:"",cancel:""},$scope.payment_status_filter={not_pay:"",part_payed:"",all_payed:""},$scope.filter_data={payment_status:[],goods_status:[],category:order_categories.underway,order_number:"",product:"",shop:"",name:"",sku:"",phone:"",city:"",min_total:"",max_total:"",min_complete_time:"",max_complete_time:"",min_confirm_time:"",max_confirm_time:"",min_book_time:"",max_book_time:""}};reset();var newDialog=function(m,n){var targetDiv=$("#canceldd"+n);targetDiv.dialog({dialogClass:"no-close",autoOpen:!1,appendTo:"body",resizable:!1,width:"40%",modal:!0,buttons:{"确认":function(){$scope.cancel_order(m,n),$(this).dialog("close")},"返回":function(){$(this).dialog("close")}},close:function(){$(this).hide()}})};$scope.confirm_cancel=function(m,n){$(newDialog(m,n)),$("#canceldd"+n).dialog("open"),$(".ui-dialog :button").blur()};var newMoneyDialog=function(m,n){var targetDiv=$("#money-confirm"+n);targetDiv.dialog({dialogClass:"no-close",autoOpen:!1,appendTo:".ddqk",width:"345px",resizable:!1,modal:!0,buttons:{"确认":function(){$scope.confirm_payment(m),$(this).dialog("close")},"返回":function(){$(this).dialog("close")}},close:function(){$(this).hide()}})};$scope.confirm_money=function(m,n){$(newMoneyDialog(m,n)),$("#money-confirm"+n).dialog("open"),$(".ui-dialog :button").blur()},$scope.show=!1,$scope.choose=function(){$scope.show=!$scope.show},$http.get(host+"/studio/order/?category="+order_categories.underway).success(function(data,status,headers,config){$scope.order_list=data.data}).error(function(data,status,headers,config){console.log(data)}),$scope.delivery=function(i){i.wait_visible=!0},$scope.cancel_deliver=function(i){i.wait_visible=!1},$scope.show_confirm=function(i){$scope.win_visible=!0},$scope.cancel_order=function(i,index){var data={cancel:!0,content:$scope.cancel_reason};$http.put(host+"/studio/order/"+i.id+"/",data).success(function(data,status,headers,config){i.goods_status=3,$scope.order_list.splice(index,1)}).error(function(data,status,headers,config){console.log(data)})},$scope.confirm_deposit=function(i){var data={payment_status:1};$http.put(host+"/studio/order/"+i.id+"/",data).success(function(data,status,headers,config){i.payment_status=1}).error(function(data,status,headers,config){console.log(data)})},$scope.confirm_payment=function(i){var data={payment_status:2};$http.put(host+"/studio/order/"+i.id+"/",data).success(function(data,status,headers,config){i.payment_status=1}).error(function(data,status,headers,config){console.log(data)})},$scope.confirm_delivery=function(i){var data={confirm:1,delivery:i.delivery,express_num:i.express_num};$http.put(host+"/studio/order/"+i.id+"/",data).success(function(data,status,headers,config){i.goods_status=1,i.wait_visible=!1}).error(function(data,status,headers,config){console.log(data)})},$scope.filter_orders=function(){$scope.filter_data.goods_status=[],angular.forEach($scope.goods_status_filter,function(v,k){""!==v&&$scope.filter_data.goods_status.push(v)}),$scope.filter_data.payment_status=[],angular.forEach($scope.payment_status_filter,function(v,k){""!==v&&$scope.filter_data.payment_status.push(v)}),$http.post(host+"/studio/orderfilter/",$scope.filter_data).success(function(data,status,headers,config){$scope.order_list=data.data,$.msg_bre({content:"搜索完成"})}).error(function(data,status,headers,config){console.log(data)})}}).controller("OrdersFinishCtrl",function($scope,$http,$location,$routeParams,order_categories,goods_status,payment_status){$scope.checked_id=[],$scope.headChecked=!1,$scope.SelectAll=function(list){$scope.headChecked=!$scope.headChecked,Select_All(list,$scope.checked_id,$scope.headChecked)},$scope.SelectOne=function(i){Select_One(i,$scope.checked_id)},$scope.newWindow=function(){new_Window($scope.checked_id)},$scope.order_by="index",$scope.reverse=!0,$scope.order=function(order_by){$scope.reverse=$scope.order_by===order_by?!$scope.reverse:!1,$scope.order_by=order_by},$(".finish-time-from,.finish-time-to,.deal-time-from,.deal-time-to").datepicker({dateFormat:"yy-mm-dd"}),$scope.order_reset=function(){reset()},$scope.goods_status=goods_status,$scope.payment_status=payment_status;var reset=function(){$scope.deal_status_filter={2:"",3:""},$scope.goods_status_filter={not_delivery:"",delivery:"",done:"",cancel:""},$scope.payment_status_filter={not_pay:"",payed:""},$scope.filter_data={category:order_categories.finish,order_number:"",product:"",shop:"",name:"",sku:"",phone:"",city:"",min_total:"",max_total:"",min_complete_time:"",max_complete_time:"",min_confirm_time:"",max_confirm_time:"",min_book_time:"",max_book_time:""}};reset(),$scope.show=!1,$scope.choose=function(){$scope.show=!$scope.show},$http.get(host+"/studio/order/?category="+order_categories.finish).success(function(data,status,headers,config){$scope.order_list=data.data}).error(function(data,status,headers,config){console.log(data)}),$scope.filter_orders=function(){$http.post(host+"/studio/orderfilter/",$scope.filter_data).success(function(data,status,headers,config){$scope.order_list=data.data,$.msg_bre({content:"搜索完成"})}).error(function(data,status,headers,config){console.log(data)})}}).controller("OrdersCancelCtrl",function($scope,$http,$location,$routeParams,order_categories,goods_status,payment_status){$scope.checked_id=[],$scope.headChecked=!1,$scope.SelectAll=function(list){$scope.headChecked=!$scope.headChecked,Select_All(list,$scope.checked_id,$scope.headChecked)},$scope.SelectOne=function(i){Select_One(i,$scope.checked_id)},$scope.newWindow=function(){new_Window($scope.checked_id)},$scope.order_by="index",$scope.reverse=!0,$scope.order=function(order_by){$scope.reverse=$scope.order_by===order_by?!$scope.reverse:!1,$scope.order_by=order_by},$(".finish-time-from,.finish-time-to,.deal-time-from,.deal-time-to").datepicker({dateFormat:"yy-mm-dd"}),$scope.order_reset=function(){reset()},$scope.goods_status=goods_status,$scope.payment_status=payment_status;var reset=function(){$scope.filter_data={category:order_categories.cancel,order_number:"",product:"",shop:"",name:"",sku:"",phone:"",city:"",min_total:"",max_total:"",min_complete_time:"",max_complete_time:"",min_confirm_time:"",max_confirm_time:"",min_book_time:"",max_book_time:""}};reset(),$scope.show=!1,$scope.choose=function(){$scope.show=!$scope.show},$http.get(host+"/studio/order/?category="+order_categories.cancel).success(function(data,status,headers,config){$scope.order_list=data.data}).error(function(data,status,headers,config){console.log(data)}),$scope.filter_orders=function(){$http.post(host+"/studio/orderfilter/",$scope.filter_data).success(function(data,status,headers,config){$scope.order_list=data.data,$.msg_bre({content:"搜索完成"})}).error(function(data,status,headers,config){console.log(data)})}}).controller("OrdersAllCtrl",function($scope,$http,$location,$route,$routeParams,goods_status,payment_status){$scope.checked_id=[],$scope.headChecked=!1,$scope.SelectAll=function(list){$scope.headChecked=!$scope.headChecked,Select_All(list,$scope.checked_id,$scope.headChecked)},$scope.SelectOne=function(i){Select_One(i,$scope.checked_id)},$scope.newWindow=function(){new_Window($scope.checked_id)},$scope.order_by="index",$scope.reverse=!0,$scope.order=function(order_by){$scope.reverse=$scope.order_by===order_by?!$scope.reverse:!1,$scope.order_by=order_by},$(".finish-time-from,.finish-time-to,.deal-time-from,.deal-time-to").datepicker({dateFormat:"yy-mm-dd"}),$scope.payment_status=payment_status,$scope.goods_status=goods_status,$scope.order_reset=function(){reset()};var reset=function(){$scope.goods_status_filter={not_confirmed:"",not_delivery:"",delivery:"",done:"",cancel:""},$scope.payment_status_filter={not_pay:"",part_payed:"",all_payed:""},$scope.filter_data={payment_status:[],goods_status:[],order_number:"",product:"",shop:"",name:"",sku:"",phone:"",city:"",min_total:"",max_total:"",min_complete_time:"",max_complete_time:"",min_confirm_time:"",max_confirm_time:"",min_book_time:"",max_book_time:""}};reset();var newDialog=function(m,n){var targetDiv=$("#canceldd"+n);targetDiv.dialog({dialogClass:"no-close",autoOpen:!1,appendTo:"body",resizable:!1,width:"40%",modal:!0,buttons:{"确认":function(){$scope.cancel_order(m,n),$(this).dialog("close")},"返回":function(){$(this).dialog("close")}},close:function(){$(this).hide()}})};$scope.confirm_cancel=function(m,n){$(newDialog(m,n)),$("#canceldd"+n).dialog("open"),$(".ui-dialog :button").blur()};var newMoneyDialog=function(m,n){var targetDiv=$("#money-confirm"+n);targetDiv.dialog({dialogClass:"no-close",autoOpen:!1,appendTo:".ddqk",width:"345px",resizable:!1,modal:!0,buttons:{"确认":function(){$scope.confirm_payment(m),$(this).dialog("close")},"返回":function(){$(this).dialog("close")}},close:function(){$(this).hide()}})};$scope.confirm_money=function(m,n){$(newMoneyDialog(m,n)),$("#money-confirm"+n).dialog("open"),$(".ui-dialog :button").blur()},$scope.show=!1,$scope.choose=function(){$scope.show=!$scope.show},$http.get(host+"/studio/order/").success(function(data,status,headers,config){$scope.order_list=data.data}).error(function(data,status,headers,config){console.log(data)}),$scope.delivery=function(i){i.wait_visible=!0},$scope.cancel_deliver=function(i){i.wait_visible=!1},$scope.show_confirm=function(i){$scope.win_visible=!0},$scope.cancel_order=function(i,index){var data={cancel:!0};$http.put(host+"/studio/order/"+i.id+"/",data).success(function(data,status,headers,config){i.goods_status=3,$scope.order_list.splice(index,1)}).error(function(data,status,headers,config){console.log(data)})},$scope.confirm_payment=function(i){var data={payment_status:1};$http.put(host+"/studio/order/"+i.id+"/",data).success(function(data,status,headers,config){i.payment_status=1}).error(function(data,status,headers,config){console.log(data)})},$scope.confirm_delivery=function(i){var data={confirm:1,delivery:i.delivery,express_num:i.express_num};$http.put(host+"/studio/order/"+i.id+"/",data).success(function(data,status,headers,config){i.goods_status=1,i.wait_visible=!1}).error(function(data,status,headers,config){console.log(data)})},$scope.filter_orders=function(){$scope.filter_data.goods_status=[],angular.forEach($scope.goods_status_filter,function(v,k){""!==v&&$scope.filter_data.goods_status.push(v)}),$scope.filter_data.payment_status=[],angular.forEach($scope.payment_status_filter,function(v,k){""!==v&&$scope.filter_data.payment_status.push(v)}),$http.post(host+"/studio/orderfilter/",$scope.filter_data).success(function(data,status,headers,config){$scope.order_list=data.data,$.msg_bre({content:"搜索完成"})}).error(function(data,status,headers,config){console.log(data)})}}).controller("OrderDetailCtrl",function($scope,$http,$location,$routeParams){$http.get(host+"/studio/order/"+$routeParams.order_id+"/").success(function(data,status,headers,config){$scope.order=data.data}).error(function(data,status,headers,config){console.log(data)}),$scope.price_type={0:"以零售价为基准",1:"以打折价为基准"},$scope.payment_status={0:"未付款",1:"订金已收",2:"全款已收"},$scope.goods_status={"-1":"未确认",0:"未发货",1:"已发货",2:"交易完成",3:"交易取消"},$scope.update_order=function(){$http.put(host+"/studio/order/"+$scope.order.id+"/",$scope.order).success(function(data,status,headers,config){console.log(data)}).error(function(data,status,headers,config){console.log(data)})};var cDialog=function(){var targetDiv=$("#confirmdd");targetDiv.dialog({dialogClass:"no-close",autoOpen:!1,appendTo:".wrapper",width:"345px",resizable:!1,modal:!0,buttons:{"确认":function(){$scope.confirm_order(),$(this).dialog("close")},"返回":function(){$(this).dialog("close")}},close:function(){$(this).hide()}})};$scope.confirm_dd=function(){$(cDialog()),$("#confirmdd").dialog("open"),$(".ui-dialog :button").blur()};var newDialog=function(order_id){var targetDiv=$("#canceldd"+order_id);targetDiv.dialog({dialogClass:"no-close",autoOpen:!1,appendTo:".wrapper",width:"40%",resizable:!1,modal:!0,buttons:{"确认":function(){$scope.cancel_order(order_id),$(this).dialog("close")},"返回":function(){$(this).dialog("close")}},close:function(){$(this).hide()}})};$scope.confirm_cancel=function(order_id){$(newDialog(order_id)),$("#canceldd"+order_id).dialog("open"),$(".ui-dialog :button").blur()};var newDepositMoneyDialog=function(order_id){var targetDiv=$("#deposit-money-confirm"+order_id);targetDiv.dialog({dialogClass:"no-close",autoOpen:!1,appendTo:".wrapper",width:"345px",resizable:!1,modal:!0,buttons:{"确认":function(){$scope.confirm_deposit_payment(order_id),$(this).dialog("close")},"返回":function(){$(this).dialog("close")}},close:function(){$(this).hide()}})};$scope.confirm_depositMoney=function(order_id){$(newDepositMoneyDialog(order_id)),$("#deposit-money-confirm"+order_id).dialog("open"),$(".ui-dialog :button").blur()};var newAllMoneyDialog=function(order_id){var targetDiv=$("#all-money-confirm"+order_id);targetDiv.dialog({dialogClass:"no-close",autoOpen:!1,appendTo:".wrapper",width:"345px",resizable:!1,modal:!0,buttons:{"确认":function(){$scope.confirm_all_payment(order_id),$(this).dialog("close")},"返回":function(){$(this).dialog("close")}},close:function(){$(this).hide()}})};$scope.confirm_allMoney=function(order_id){
$(newAllMoneyDialog(order_id)),$("#all-money-confirm"+order_id).dialog("open"),$(".ui-dialog :button").blur()};var sendDialog=function(order_id){var targetDiv=$("#delivery"+order_id);targetDiv.dialog({dialogClass:"no-close",autoOpen:!1,appendTo:".wrapper",width:"345px",resizable:!1,modal:!0,buttons:{"确认发货":function(){$scope.confirm_delivery(order_id),$(this).dialog("close")},"返回":function(){$(this).dialog("close")}},close:function(){$(this).hide()}})};$scope.delivery=function(order_id){$(sendDialog(order_id)),$("#delivery"+order_id).dialog("open"),$(".ui-dialog :button").blur()},$scope.showDeal=!0,$scope.change_discount=function(){$scope.temporary_discount=$scope.order.discount,$scope.showDeal=!1},$scope.save_discount=function(order_id){$scope.showDeal=!0,$http.put(host+"/studio/order/"+order_id+"/",{discount:$scope.temporary_discount}).success(function(data,status,headers,config){$scope.order.discount=$scope.temporary_discount}).error(function(data,status,headers,config){console.log(data)})},$scope.change_cancel=function(){$scope.showDeal=!0},$scope.confirm_order=function(){var data={confirm:!0};$http.put(host+"/studio/order/"+$scope.order.id+"/",data).success(function(data,status,headers,config){$scope.order.goods_status=0}).error(function(data,status,headers,config){console.log(data)})},$scope.cancel_order=function(){var data={cancel:!0,content:$scope.cancel_reason};$http.put(host+"/studio/order/"+$scope.order.id+"/",data).success(function(data,status,headers,config){$scope.order.goods_status=3}).error(function(data,status,headers,config){console.log(data)})},$scope.confirm_deposit_payment=function(){var data={payment_status:1};$http.put(host+"/studio/order/"+$scope.order.id+"/",data).success(function(data,status,headers,config){$scope.order.payment_status=1}).error(function(data,status,headers,config){console.log(data)})},$scope.confirm_all_payment=function(){var data={payment_status:2};$http.put(host+"/studio/order/"+$scope.order.id+"/",data).success(function(data,status,headers,config){$scope.order.payment_status=2}).error(function(data,status,headers,config){console.log(data)})},$scope.confirm_delivery=function(){var data={send_goods:1,delivery:$scope.order.delivery,express_num:$scope.order.express_num};$http.put(host+"/studio/order/"+$scope.order.id+"/",data).success(function(data,status,headers,config){$scope.order.goods_status=1,$scope.order.wait_visible=!1}).error(function(data,status,headers,config){console.log(data)})}}).controller("OrderStatCtrl",function($scope,$http,$location,$routeParams,$route){var post_data={ids:$routeParams.checked_id};$http.put(host+"/studio/orderstat/",post_data).success(function(data,status,headers,post_data){$scope.order_list=data.data}).error(function(data,status,headers,config){console.log(data)})}).controller("ProductManageCtrl",function($scope,$http,$routeParams,$location,productService){$scope.order_by="created",$scope.reverse=!0,$scope.sortWay="添加时间降序",$scope.showSort=!1,$scope.proOrder=function(order_by,upDown,method){$scope.reverse=upDown,$scope.order_by=order_by,$scope.sortWay=method,$scope.showSort=!1},$scope.showOrder=function(){$scope.showSort=!$scope.showSort},$scope.hideSort=function(e){$(".eTarget").is(event.target)||($scope.showSort=!1)};$scope.changeNum=function(){$.msg_bre({model:"make.5",vanish:!1,inverse:!0,make:[{col:1,tag:"span","class":"",text:"总数量{{product.count}}"},{col:2,tag:"span","class":"",text:"均码"},{col:2,tag:"text","class":"",text:""},{col:3,tag:"span","class":"",text:"S码"},{col:3,tag:"text","class":"",text:""},{col:4,tag:"confirm","class":"btn btn-action",text:"保存"},{col:4,tag:"cancel","class":"btn btn-action",text:"取消"}]})},$scope.order_reset=function(){reset()};var reset=function(){$scope.filter_data={channel:[],collection:[],category:[],gender:[],pre_order:[],min_price:"",max_price:"",product:"",sku:"",name:""},$scope.pre_order_filter={0:"",1:""},$scope.gender_filter={all:"",male:"",female:""},$scope.col_filter={},angular.forEach($scope.collections,function(i){$scope.col_filter[i.title]=""}),$scope.cate_filter={},angular.forEach($scope.categories,function(i){$scope.cate_filter[i.name]=""})};reset(),$scope.show=!1,$scope.choose=function(){$scope.show=!$scope.show},$scope.filter_products=function(){$scope.filter_data.gender=[],angular.forEach($scope.gender_filter,function(v,k){""!==v&&$scope.filter_data.gender.push(v)}),$scope.filter_data.pre_order=[],angular.forEach($scope.pre_order_filter,function(v,k){""!==v&&$scope.filter_data.pre_order.push(v)}),$scope.filter_data.collection=[],angular.forEach($scope.collections,function(i){""!==$scope.col_filter[i.title]&&$scope.filter_data.collection.push($scope.col_filter[i.title])}),$scope.filter_data.category=[],angular.forEach($scope.categories,function(i){""!==$scope.cate_filter[i.name]&&$scope.filter_data.category.push($scope.cate_filter[i.name])}),productService.filter_product_list($scope)},productService.get_product_list($scope),productService.get_collections($scope)}).controller("AnnouncementListCtrl",function($scope,$http,$location,$routeParams){$http.get(host+"/common/message/").success(function(data,status,headers,config){$scope.data=data.data}).error(function(data,status,headers,config){console.log(data)})}),function($,window,document,undefined){var MSG_F=function(ele,opt){this.$element=ele,this.defaults={content:"Success",model:"message"},this.ex={dom:"body",vanish:!0,inverse:!1,wrapper:[!0,"#ffffff","0.8","900"],make:[],msg_confirm:function(){return null},msg_cancel:function(){return null}},this.options=$.extend({},this.defaults,this.ex,opt)};MSG_F.prototype={showMessage:function(){var $o=this.options;$(".msg_bre").length&&($(".msg_bre").remove(),$(".msg_bre_wrapper").remove()),$o.wrapper[0]&&$("body").prepend('<div class="msg_bre_wrapper" style="width:100%;height:100%;position:fixed;left:0;top:0;background-color:'+$o.wrapper[1]+";opacity:"+$o.wrapper[2]+";z-index:"+$o.wrapper[3]+'"></div>'),$($o.dom).prepend('<div class="msg_bre"></div>');var height,$tmp_dom,$dom=$(".msg_bre"),$wrapper=$(".msg_bre_wrapper");$dom.css({opacity:"0"});var $model=$o.model.split(".");switch($model[0]){case"make":var ori_htm,htm,colnum=parseInt($model[1]),i=1,tmp_colnum=colnum;if(colnum){for($dom.prepend('<div class="msg_bre_make"></div>'),$tmp_dom=$(".msg_bre_make"),i=1;colnum>=i;i++)$tmp_dom.prepend("<p></p>");var $tmp_dom_inner=$(".msg_bre_make p");colnum=$o.make.length;var m_col,defaults;for(i=0;colnum>i;i++){switch(htm="",defaults={col:1,tag:"span","class":"",text:"",before:""},$.extend(defaults,$o.make[i]),defaults.tag){case"a":htm='<a class="'+defaults["class"]+'">'+defaults.text+"</a>";break;case"span":htm='<span class="'+defaults["class"]+'">'+defaults.text+"</span>";break;case"text":htm=defaults.before+'<input type="text" class="'+defaults["class"]+'" value="'+defaults.text+'">';break;case"confirm":htm='<a role="button" class="btn_bre_confirm '+defaults["class"]+'">'+defaults.text+"</a>";break;case"cancel":htm='<a role="button" class="btn_bre_cancel '+defaults["class"]+'">'+defaults.text+"</a>"}m_col=parseInt(defaults.col),m_col>tmp_colnum&&(m_col=tmp_colnum),ori_htm=$tmp_dom_inner.eq(m_col-1).html(),$tmp_dom_inner.eq(m_col-1).html(ori_htm+htm)}}else $dom.html("<p>参数设置错误！</p>");height=($dom.height()-$tmp_dom.height())/2,$tmp_dom.css({position:"relative",top:height});break;default:$dom.html("<p>"+$o.content+"</p>"),height=($dom.height()-$dom.find("p").height())/2,$dom.find("p").css({position:"relative",top:height})}$(".btn_bre_confirm")&&$(".btn_bre_confirm").one("click",function(e){$o.msg_confirm(),$dom.fadeOut(),$wrapper.fadeOut()}),$(".btn_bre_cancel")&&$(".btn_bre_cancel").one("click",function(e){$o.msg_cancel(),$dom.fadeOut(),$wrapper.fadeOut()}),height=$dom.height(),height=0-height/2,$dom.css({"margin-top":height+"px"}),height-=25,$o.inverse&&$dom.css({"border-color":"#dcdcdc","background-color":"#fff","box-shadow":"0 0 12px #dcdcdc",color:"#4a4a4a"}),$dom.show().animate({marginTop:height+"px",opacity:"1"},400),$wrapper.fadeIn(),$o.vanish&&($dom.delay(1e3).fadeOut(),$wrapper.delay(1400).fadeOut())}},$.extend({msg_bre:function(options){var main=new MSG_F(this,options);return main.showMessage()}})}(jQuery,window,document),$(document).mouseup(function(e){var dom=$(".msg_bre"),wrapper=$(".msg_bre_wrapper");dom.is(e.target)||0!==dom.has(e.target).length||(dom.fadeOut(),wrapper.fadeOut())}),app.controller("PreViewProductCtrl",function($scope,$http,$location,$routeParams,anchorSmoothScroll){$http.get(host+"/products/"+$routeParams.id+"/").success(function(data,status,headers,config){$scope.product=data,$scope.tags=data.tags.join(","),$scope.product.composition=$scope.product.composition.replace(/\n/g,"<br/>"),$scope.product.description=$scope.product.description.replace(/\n/g,"<br/>")}).error(function(data,status,headers,config){console.log(data)});var sc_height=0,sc_top=0,sc_cal=0,dom=$(".product-info"),dom_height=dom.height();sc_height=$("body").height(),sc_height>dom_height+155&&dom.css({postion:"absolute",bottom:"auto"}),window.onscroll=function(){sc_top=$("body").scrollTop(),sc_height=$("body").height(),sc_cal=120+dom_height-sc_height,sc_top>sc_cal&&dom_height+155>sc_height?"absolute"==dom.css("position")&&dom.css({position:"fixed",bottom:"10px"}):sc_height>dom_height+155?("absolute"==dom.css("position")||"10px"==dom.css("bottom"))&&dom.css({position:"fixed",bottom:"auto"}):"fixed"==dom.css("position")&&dom.css({position:"absolute",bottom:"auto"})},$scope.gotoElement=function(eID){anchorSmoothScroll.scrollTo(0===eID?"top":"tag"+eID)}}).controller("PreViewBrandCtrl",function($scope,$http,$location,$route){}).controller("PreViewProductListCtrl",function($scope,$http,$location,$route){angular.element(document).ready(function(){$scope.mouse_enter=function(evt){$(evt.currentTarget).find(".item-info").css({opacity:"0.8",transform:"scale(1,1)"})},$scope.mouse_leave=function(evt){$(evt.currentTarget).find(".item-info").css({opacity:"0",transform:"scale(1.2,1.2)"})},$scope.detail_page=function(id){$location.path("/preview_product/"+id)}}),$scope.show_brandlist=function(e){var dom=$(e.currentTarget);dom.hasClass("brands-active")?(dom.removeClass("brands-active"),dom.parent().find(".brands-list").slideUp()):($(".brands-active").removeClass("brands-active"),$(".brands-list").slideUp(),dom.addClass("brands-active"),dom.parent().find(".brands-list").slideDown())},$http.get(host+"/products/").success(function(data,status,headers,config){$scope.products=data}).error(function(data,status,headers,config){console.log(data)})});var headChecked=!1,Select_One=function(i,checked_id){i.checked=!i.checked,i.checked?checked_id.push(i.id):i.checked||checked_id.splice($.inArray(i.id,checked_id),1)},Select_All=function(list,checked_id,headChecked){headChecked?angular.forEach(list,function(i){i.checked||(i.checked=!0,checked_id.push(i.id))}):headChecked||(angular.forEach(list,function(i){i.checked=!1}),checked_id.splice(0,checked_id.length))},new_Window=function(checked_id){0===checked_id.length?$.msg_bre({content:"未选择订单"}):window.open("#/orders_statistics/"+checked_id)};app.factory("sharedProperties",function(){var email="";return{set_email:function(em){email=em},get_email:function(){return email}}}).factory("productService",function($http){return{get_product_list:function(scope){$http.get(host+"/products/").success(function(data,status,headers,config){scope.products=data}).error(function(data,status,headers,config){console.log(data)})},get_collections:function(scope){$http.get(host+"/collection/").success(function(data,status,headers,config){scope.collections=data,scope.col_filter={},angular.forEach(scope.collections,function(i){scope.col_filter[i.title]=""})}).error(function(data,status,headers,config){console.log(data)})},filter_product_list:function(scope){$http.post(host+"/studio/productfilter/",scope.filter_data).success(function(data,status,headers,config){scope.products=data,$.msg_bre({content:"搜索完成"})}).error(function(data,status,headers,config){console.log(data)})}}}).factory("buyerService",function($http){return{get_buyer_list:function(scope){$http.get(host+"/studio/group/").success(function(data,status,headers,config){scope.buyer_list=data.data}).error(function(data,status,headers,config){console.log(data)})},filter_buyer_list:function(scope){$http.post(host+"/studio/buyerfilter/",scope.filter_data).success(function(data,status,headers,config){scope.buyer_list=data.data,scope.avoidClick=!1,$.msg_bre({content:"搜索完成"})}).error(function(data,status,headers,config){console.log(data),scope.avoidClick=!1})}}}).factory("brandService",function($http,$cookieStore){var home_scope=null;return{init:function(scope){home_scope=scope},get_brand_list:function(){null!==home_scope&&$http.get(host+"/brand/").success(function(data,status,headers,config){home_scope.g_brand_list=data}).error(function(data,status,headers,config){console.log(data)})},get_profile:function(){null!==home_scope&&$http.get(host+"/studio/").success(function(data,status,headers,config){home_scope.g_studio=data,home_scope.g_avatar_url=data.avatar_detail.url?host+data.avatar_detail.url:"images/bredgy-icon.png"}).error(function(data,status,headers,config){console.log(data)})},get_brand_info:function(){null!==home_scope&&$http.get(host+"/brand/"+$cookieStore.get("bpk")+"/").success(function(data,status,headers,config){home_scope.g_brand=data,home_scope.g_image_url=data.image_detail.url?host+data.image_detail.url:"images/logo_default.png"}).error(function(data,status,headers,config){console.log(data)})},set_avatar_url:function(url){home_scope.g_avatar_url=host+url},set_image_url:function(url){home_scope.g_image_url=url?"http"!==url.substring(0,4)?host+url:url:"images/logo_default.png"},set_username:function(username){home_scope.g_studio.username=username}}}).factory("cropService",function($http,$timeout,$cookieStore,Cropper,brandService){var file,data;return{init:function(scope,crop_w,crop_h,url,result_w,result_h,key){function showCropper(){scope.$broadcast(scope.showEvent)}function hideCropper(){scope.$broadcast(scope.hideEvent)}scope.onFile=function(blob){Cropper.encode(file=blob).then(function(dataUrl){scope.dataUrl=dataUrl,$timeout(showCropper)})},scope.cropper={},scope.cropperProxy="cropper.first",scope.crop=function(){file&&data&&Cropper.crop(file,data).then(function(blob){return Cropper.scale(blob,{width:result_w,height:result_h})}).then(Cropper.encode).then(function(dataUrl){var img=dataUrl.replace(/^data:image\/(png|jpg|jpeg);base64,/,""),data={filetype:file.type.split("/")[1]};data[key]=img,$http.post(host+url,data).success(function(data,status,headers,config){$("#image_detail").attr("src",host+data.url),$(".avatar").fadeOut(),$(".wrapper_white").fadeOut(),brandService.set_avatar_url(data.url)}).error(function(data,status,headers,config){console.log(data)})})},scope.options={guides:!1,highlight:!1,dragCrop:!1,cropBoxResizable:!1,autoCropArea:1e-8,minCropBoxWidth:crop_w,minCropBoxHeight:crop_h,crop:function(dataNew){data=dataNew}},scope.showEvent="show",scope.hideEvent="hide",$(".btn_avatar_save").on("click",function(){$(".avatar").fadeOut(),$(".wrapper_white").fadeOut(),$(".ng-image-crop button").click()}),scope.get_avatar=function(){$(".avatar input[type=file]").click(),hideCropper()},$(".btn_avatar_cancel").on("click",function(){$(".avatar").fadeOut(),$(".wrapper_white").fadeOut()}),$(".avatar input[type=file]").on("change",function(){file&&($(".avatar").fadeIn(),$(".wrapper_white").fadeIn())})},crop_image:function(scope,result_w,result_h){file&&data&&Cropper.crop(file,data).then(function(blob){return Cropper.scale(blob,{width:result_w,height:result_h})}).then(Cropper.encode).then(function(dataUrl){var img=dataUrl.replace(/^data:image\/(png|jpg|jpeg);base64,/,"");scope.image1={filetype:file.type,base64:img,filename:file.name}})},upload_product_image:function(scope,result_w,result_h){file&&data&&Cropper.crop(file,data).then(function(blob){return Cropper.scale(blob,{width:result_w,height:result_h})}).then(Cropper.encode).then(function(dataUrl){var img=dataUrl.replace(/^data:image\/(png|jpg|jpeg);base64,/,""),post_data={image:{filetype:file.type,base64:img,filename:file.name},is_primary:!0,product_id:scope.product.id};scope.product.images[0]?$http.put(host+"/product/images/"+scope.product.images[0].pk+"/",post_data).success(function(data,status,headers,config){scope.product.images[0]=data}).error(function(data,status,headers,config){console.log(data)}):$http.post(host+"/product/images/",post_data).success(function(data,status,headers,config){$scope.product.images[0]=data}).error(function(data,status,headers,config){console.log(data)})})},upload_brand_image:function(scope,result_w,result_h,brand_id){file&&data&&Cropper.crop(file,data).then(function(blob){return Cropper.scale(blob,{width:result_w,height:result_h})}).then(Cropper.encode).then(function(dataUrl){var img=dataUrl.replace(/^data:image\/(png|jpg|jpeg);base64,/,""),data={filetype:file.type.split("/")[1],image:img,id:brand_id};$http.post(host+"/brand/update_image/",data).success(function(data,status,headers,config){scope.brand.image_detail.url=data.url,$(".avatar").fadeOut(),$(".wrapper_white").fadeOut();var bpk=$cookieStore.get("bpk");bpk===parseInt(brand_id)&&brandService.set_image_url(data.url)}).error(function(data,status,headers,config){console.log(data)})})}}}).factory("checkService",function($http,$timeout,Cropper){return{checkUsable:function(cur_element){return cur_element.hasClass("btn-loading")?!1:(cur_element.addClass("btn-loading"),!0)},doAfterAction:function(cur_element){cur_element.removeClass("btn-loading")}}}).service("anchorSmoothScroll",function(){this.scrollTo=function(eID){function currentYPosition(){return self.pageYOffset?self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0}function elmYPosition(eID){for(var elm=document.getElementById(eID),y=elm.offsetTop,node=elm;node.offsetParent&&node.offsetParent!=document.body;)node=node.offsetParent,y+=node.offsetTop;return y}var stopY,startY=currentYPosition();stopY="top"==eID?0:elmYPosition(eID);var distance=stopY>startY?stopY-startY:startY-stopY;if(100>distance)return void scrollTo(0,stopY);var speed=Math.round(distance/100);speed>=20&&(speed=20);var step=Math.round(distance/25),leapY=stopY>startY?startY+step:startY-step,timer=0;if(stopY>startY)for(var i=startY;stopY>i;i+=step)setTimeout("window.scrollTo(0, "+leapY+")",timer*speed),leapY+=step,leapY>stopY&&(leapY=stopY),timer++;else for(var j=startY;j>stopY;j-=step)setTimeout("window.scrollTo(0, "+leapY+")",timer*speed),leapY-=step,stopY>leapY&&(leapY=stopY),timer++}});